!function(e,t){for(var r in t)e[r]=t[r]}(exports,function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=43)}([function(e,t){e.exports=require("mongoose")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(15)),o=u(r(14)),a=u(r(13));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=function(){var e=a.default.get();if(e.length>1){var t=e[2],r=n.default.basename(t.getFileName()).replace(".js",""),o=t.getFunctionName();return" "+r+":"+(o||"anonymous")+":"+t.getLineNumber()}return" "},r={log:(0,o.default)("TP:"+e+t()),error:(0,o.default)("TP:"+e+t())};return r.log.log=console.log.bind(console),r.error.log=console.error.bind(console),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(37)),o=i(r(36)),a=i(r(35)),u=i(r(33));function i(e){return e&&e.__esModule?e:{default:e}}var s={env:"production",dockerEnv:process.env.DOCKER_ENV},l={$meta:"main server config",pkg:o.default,server:a.default,auth:u.default},d=new n.default.Store(l);t.default={get:function(e){return d.get(e,s)},load:function(e){return d.load(e)},store:d}},function(e,t){e.exports=require("hoek")},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var o=n.default.Schema,a=new o({email:{type:String,default:""},organization:{name:{type:String,default:""},office:{type:String,default:""},offcies:{type:Array,default:[]}},profile:{name:{type:String,default:""},firstName:{type:String,default:""},lastName:{type:String,default:""}},roles:{type:Array,default:["basic bitch"]},password:{type:String,default:""},gender:{type:String,default:"male"},managerid:{type:o.ObjectId,ref:"Users"},customerids:[{type:o.ObjectId,ref:"Customers"}],createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now},dialogflow:{userStorage:{type:Object,default:{}}},role:{type:String,default:""}}),u=void 0;try{u=n.default.model("Users",a)}catch(e){u=n.default.model("Users")}e.exports=u},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createJwt=void 0;var n=u(r(3)),o=u(r(6)),a=u(r(2));function u(e){return e&&e.__esModule?e:{default:e}}t.createJwt=function(e){var t={id:e._id,scope:e.roles,organization:e.organization,createdAt:Date.now()},r=n.default.applyToDefaults({key:null,expires:"1m",verifyOptions:{algorithms:["HS256"]}},a.default.get("/auth"));return o.default.sign(t,r.key,{algorithm:r.verifyOptions.algorithms[0],expiresIn:r.expires})}},function(e,t){e.exports=require("joi")},function(e,t){e.exports=require("boom")},function(e,t){e.exports=require("bcrypt")},function(e,t,r){"use strict";var n=s(r(10)),o=s(r(9)),a=s(r(8)),u=s(r(4)),i=r(7);function s(e){return e&&e.__esModule?e:{default:e}}var l=(0,s(r(1)).default)("login").log,d=async function(e,t){try{var r=e.payload;l(r,"payload");var a=r.organization,s=r.email,d=r.password,c=r.role,f=await u.default.findOne({email:s,role:c,organization:a}).exec();if(!f)return o.default.unauthorized();var p=await n.default.compare(d,f.password);return console.log(p,"sdfsafd"),p?(0,i.createJwt)(f):o.default.notFound("Sorry, that password or email is not recognized.")}catch(e){throw e}};t.plugin={name:"login",register:async function(e,t){return e.route({method:"POST",path:"/login",handler:d,config:{auth:!1,validate:{payload:{email:a.default.string().email().required(),password:a.default.string().required(),organization:a.default.string().required(),role:a.default.string().required()}}}}),Promise.resolve()}}},function(e,t,r){"use strict";var n=(0,function(e){return e&&e.__esModule?e:{default:e}}(r(1)).default)("hello").log;t.plugin={name:"hello",register:async function(e,t){return e.route({method:"GET",path:"/hello",handler:async function(e,t){return n("hi"),"it works"}}),Promise.resolve()}}},function(e,t){e.exports=require("stack-trace")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("bluebird")},function(e,t,r){"use strict";var n=i(r(5)),o=i(r(16)),a=(i(r(3)),i(r(0))),u=i(r(2));function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,i(r(1)).default)("mongo").log;o.default.config({cancellation:!1,longStackTraces:!0,monitoring:!0,warnings:!0}),global.Promise=o.default,a.default.Promise=o.default;var l=u.default.get("/mongo"),d={useMongoClient:!0,autoIndex:!1,reconnectTries:Number.MAX_VALUE,reconnectInterval:500,poolSize:10,bufferMaxEntries:0,db:{native_parser:!0},autoReconnect:!0};d.promiseLibrary=o.default,d.socketOptions={},d.socketOptions.keepAlive=3e4,d.socketOptions.connectTimeoutMS=3e5,d.socketOptions.socketTimeoutMS=12e4,t.plugin={name:"mongo"},t.plugin.register=async function(e,t,r){l={uri:"mongodb+srv://devadmin:huzzah@cluster0-g1jmo.mongodb.net/test?retryWrites=true"};var o=!n.default.includes(["production"],"production"),u=!n.default.includes(["test"],"production");a.default.set("debug",u),a.default.connection.readyState&&(s("Mongo: next, readyState"),await Promise.resolve()),console.log("asdfsafsfd"),s(["server","database","connection"],"production server CONNECTING to "+l.uri),t.config={autoIndex:o},a.default.connect(l.uri,t).then(async function(){s(["server","database","connection"],"production server CONNECTED to "+l.uri),s("Mongo: next, connect"),await Promise.resolve()}),e.ext({type:"onPostStop",method:function(e,t){var r="production server DISCONNECTING from "+l.uri+" due to server shutdown";l.uri;s(["server","database","connection"],r),s(r)}})}},function(e,t){e.exports="type Item {\n  _id: ID!\n  name: String,\n  description: String,\n  price: String,\n  agentid: ID\n}\n\nextend type Query {\n  getItemByName(name: String!): Item\n}"},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var o=n.default.Schema,a=new o({description:{type:String,default:""},name:{type:String,default:""},sku:{type:String,default:""},price:{type:Number,default:0},agentid:{type:o.ObjectId,ref:"Users"}}),u=void 0;try{u=n.default.model("Items",a)}catch(e){u=n.default.model("Items")}e.exports=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.itemResolvers=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(19));t.itemResolvers={Query:{getItemByName:async function(e,t){return await n.default.findOne({name:t.name})}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.itemType=t.itemResolvers=void 0;var n=r(20);Object.defineProperty(t,"itemResolvers",{enumerable:!0,get:function(){return n.itemResolvers}});var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(18));t.itemType=o},function(e,t){e.exports="type Customer {\n  _id: ID!\n  name: String!\n  agentid: ID!\n  status: String\n}\n\nextend type Query {\n  getCustomerByName(name: String): Customer\n}\n\nextend type Mutation {\n  createCustomer(name: String!, agentid: ID!, status: String): Customer\n}"},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var o=n.default.Schema,a=new o({name:{type:String,default:""},agentid:{type:o.ObjectId,ref:"Users"},status:{type:String,default:"dead"}}),u=void 0;try{u=n.default.model("Customers",a)}catch(e){u=n.default.model("Customers")}e.exports=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.customerResolvers=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(23));t.customerResolvers={Query:{getCustomerByName:async function(e,t){return await n.default.findOne({name:t.name})}},Mutation:{createCustomer:async function(e,t){return console.log(t),await n.default.findOneAndUpdate({name:t.name},{$set:{name:t.name,agentid:t.agentid,status:"prospect"}},{new:!0,upsert:!0})}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.customerType=t.customerResolvers=void 0;var n=r(24);Object.defineProperty(t,"customerResolvers",{enumerable:!0,get:function(){return n.customerResolvers}});var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(22));t.customerType=o},function(e,t){e.exports="type User {\n  _id: ID!\n  name: String!\n  gender: String\n  managerid: [String]\n  customerids: [String]\n}\n\ntype Query {\n  getUser(name: String, gender: String): User\n  users: [User]\n}\n\ntype Mutation {\n  createUser(name: String, gender: String): User\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userResolvers=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(4));t.userResolvers={Query:{getUser:async function(e,t){console.log(e,t);var r=void 0;return t.name&&(r=await n.default.findOne({name:t.name})),t.gender&&(r=await n.default.findOne({gender:t.gender})),r}},Mutation:{createUser:async function(e,t){return console.log(e,t),await n.default.findOneAndUpdate({name:t.name},{$set:{name:t.name,gender:t.gender}},{new:!0,upsert:!0})}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userType=t.userResolvers=void 0;var n=r(27);Object.defineProperty(t,"userResolvers",{enumerable:!0,get:function(){return n.userResolvers}});var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(26));t.userType=o},function(e,t){e.exports=require("graphql-tools")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(29),o=function(e){return e&&e.__esModule?e:{default:e}}(r(5)),a=r(28),u=r(25),i=r(21);var s=(0,n.makeExecutableSchema)({typeDefs:["\nschema {\n  query: Query\n  mutation: Mutation\n}\n",a.userType.default,u.customerType.default,i.itemType.default],resolvers:o.default.merge({},a.userResolvers,u.customerResolvers,i.itemResolvers)});t.default=s},function(e,t){e.exports=require("apollo-server-hapi")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(31),o=function(e){return e&&e.__esModule?e:{default:e}}(r(30));t.default={plugin:n.graphqlHapi,options:{path:"/graphql",graphqlOptions:function(e){var t=e.payload;return console.log(t,"<-- our graphQL request body"),{schema:o.default}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};n.key={$filter:"env",development:"development-key",sandbox:"giQqgR98eAJJtF[92mRoAnV]U3}sUhtPd$z&vW]>h7%Us3R24ZL)Kb3)",production:process.env.JWT_SECRET||"giQqgR98eAJJtF[92mRoAnV]U3}sUhtPd$z&vW]>h7%Us3R24ZL)Kb3)",test:"test-key",$default:null},n.expires={$filter:"env",development:"30d",sandbox:"30d",production:"30d",test:"1m",$default:"1h"},n.verifyOptions={algorithms:["HS256"]},n.complete=!1,n.headerKey=!1,n.urlKey="jwt",t.default=n},function(e,t){e.exports=require("events")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){return e&&e.__esModule?e:{default:e}})(r(34)).default.EventEmitter.prototype._maxListeners=100,process.setMaxListeners(100),t.default={port:process.env.PORT,host:"0.0.0.0",routes:{cors:!0}}},function(e){e.exports={name:"TruePackage",version:"1.0.0",description:"wond api",scripts:{test:'echo "Error: no test specified" && exit 1',start:"nodemon -- --inspect --debug ./node_modules/.bin/sls offline start -r us-east-1 --noTimeout --skipCacheInvalidation",deploy:"sls deploy -s production -v",logs:"sls logs -s production -t -f api"},main:"index.js",license:"MIT",dependencies:{"apollo-server-hapi":"^1.3.6","babel-core":"^6.26.3","babel-eslint":"^8.2.5","babel-loader":"^7.1.5","babel-plugin-istanbul":"^4.1.6","babel-plugin-source-map-support":"^2.0.1","babel-polyfill":"^6.26.0","babel-preset-es2015":"^6.24.1","babel-preset-stage-3":"^6.24.1","babel-runtime":"^6.26.0",bcrypt:"^3.0.0",bluebird:"^3.5.1",boom:"^7.2.0",confidence:"^3.0.2","eslint-config-walmart":"^2.2.1","eslint-plugin-filenames":"^1.3.2","eslint-plugin-import":"^2.13.0",graphql:"^0.13.2","graphql-custom-types":"^1.4.0","graphql-depth-limit":"^1.1.0","graphql-playground-middleware-hapi":"^1.7.2","graphql-playground-middleware-lambda":"^1.7.2","graphql-query-complexity":"^0.1.2","graphql-relay":"^0.5.5","graphql-tag":"^2.9.2","graphql-tools":"^3.0.5",hapi:"^17.5.2",hoek:"^5.0.3",joi:"^13.4.0","js-yaml":"^3.12.0",jsonwebtoken:"^8.3.0",lodash:"^4.17.10",mongoose:"^5.2.2",nodemon:"^1.17.5","prettier-eslint-cli":"^4.7.1","raw-loader":"^0.5.1",request:"^2.87.0","request-promise":"^4.2.2",serverless:"^1.28.0","serverless-domain-manager":"^2.6.0","serverless-offline":"^3.25.6","serverless-offline-scheduler":"^0.3.3","serverless-secrets-plugin":"^0.1.0","serverless-webpack":"^5.2.0",webpack:"^4.15.1","webpack-node-externals":"^1.7.2"}}},function(e,t){e.exports=require("confidence")},function(e,t){e.exports=require("graphql-playground-middleware-hapi")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(38));t.default={plugin:n.default,options:{path:"/playground",endpoint:"/graphql"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(39)),o=u(r(2)),a=u(r(32));function u(e){return e&&e.__esModule?e:{default:e}}var i=r(17),s={$meta:"main server manifest",server:o.default.get("/server"),register:{plugins:[{plugin:r(12)},{plugin:r(11)},{plugin:i},a.default,n.default]}};t.default=s},function(e,t){e.exports=require("graphql-playground-middleware-lambda")},function(e,t){e.exports=require("hapi")},function(e,t,r){"use strict";var n=i(r(42)),o=i(r(0)),a=i(r(41)),u=i(r(40));function i(e){return e&&e.__esModule?e:{default:e}}var s=null,l=process.env.MONGODB_URI;t.handler=async function(e,t){try{null===s&&(s=new n.default.Server({host:"localhost",port:3001,routes:{cors:!0}}),await s.register(u.default.register.plugins)),await s.start(),o.default.connect(l,{}).then(function(){console.log("connected to mongo db")}).catch(function(e){console.log(e,"asfsafsaf")})}catch(e){return e}var r=e.path,a=e.queryStringParameters,i=e.httpMethod,d=e.body,c=e.headers,f=r;if(a){var p=Object.keys(a).map(function(e){return e+"="+a[e]});p.length>0&&(f=f+"?"+p.join("&"))}var g=await s.inject({method:i,url:f,payload:d,headers:c,validate:!1}),m=g.statusCode,v=g.headers,y=g.result;return delete v["content-encoding"],delete v["transfer-encoding"],{statusCode:m,headers:v,body:y}},t.playground=(0,a.default)({endpoint:"/graphql"})}]));
//# sourceMappingURL=handler.js.map