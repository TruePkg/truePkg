!function(e,t){for(var r in t)e[r]=t[r]}(exports,function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t){e.exports=require("mongoose")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(40)),a=u(r(41)),o=u(r(42));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=function(){var e=o.default.get();if(e.length>1){var t=e[2],r=n.default.basename(t.getFileName()).replace(".js",""),a=t.getFunctionName();return" "+r+":"+(a||"anonymous")+":"+t.getLineNumber()}return" "},r={log:(0,a.default)("TP:"+e+t()),error:(0,a.default)("TP:"+e+t())};return r.log.log=console.log.bind(console),r.error.log=console.error.bind(console),r}},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var a=n.default.Schema,o=new a({email:{type:String,default:""},organization:{name:{type:String,default:""},office:{type:String,default:""},offices:{type:Array,default:[]}},profile:{name:{type:String,default:""},firstName:{type:String,default:""},lastName:{type:String,default:""}},roles:{type:Array,default:["basic bitch"]},password:{type:String,default:""},gender:{type:String,default:"male"},managerid:{type:a.ObjectId,ref:"Users"},customerids:[{type:a.ObjectId,ref:"Customers"}],createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now},dialogflow:{userStorage:{type:Object,default:{}}},role:{type:String,default:""}}),u=void 0;try{u=n.default.model("Users",o)}catch(e){u=n.default.model("Users")}e.exports=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(15)),a=s(r(16)),o=s(r(17)),u=s(r(19));function s(e){return e&&e.__esModule?e:{default:e}}var i={env:"production",dockerEnv:process.env.DOCKER_ENV},l={$meta:"main server config",pkg:a.default,server:o.default,auth:u.default},d=new n.default.Store(l);t.default={get:function(e){return d.get(e,i)},load:function(e){return d.load(e)},store:d}},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("boom")},function(e,t){e.exports=require("joi")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createJwt=void 0;var n=u(r(38)),a=u(r(39)),o=u(r(3));function u(e){return e&&e.__esModule?e:{default:e}}t.createJwt=function(e){var t={id:e._id,scope:e.roles,organization:e.organization,createdAt:Date.now()},r=n.default.applyToDefaults({key:null,expires:"1m",verifyOptions:{algorithms:["HS256"]}},o.default.get("/auth"));return a.default.sign(t,r.key,{algorithm:r.verifyOptions.algorithms[0],expiresIn:r.expires})}},function(e,t,r){"use strict";var n=i(r(9)),a=i(r(0)),o=i(r(10)),u=i(r(11)),s=i(r(12));function i(e){return e&&e.__esModule?e:{default:e}}var l=null,d=(process.env.MONGODB_URI,{autoIndex:!1,reconnectTries:Number.MAX_VALUE,reconnectInterval:500,poolSize:10,bufferMaxEntries:0,db:{native_parser:!0},autoReconnect:!0});d.promiseLibrary=u.default,d.useNewUrlParser=!0,t.handler=async function(e,t){try{null===l&&(l=new n.default.Server({host:"localhost",port:3002,routes:{cors:!0}}),await l.register(s.default.register.plugins)),await a.default.connect("mongodb+srv://devadmin:huzzah@cluster0-g1jmo.mongodb.net/test?retryWrites=true",d),await l.start()}catch(e){return e}var r=e.path,o=e.queryStringParameters,u=e.httpMethod,i=e.body,c=e.headers,f=r;if(o){var p=Object.keys(o).map(function(e){return e+"="+o[e]});p.length>0&&(f=f+"?"+p.join("&"))}var g=await l.inject({method:u,url:f,payload:i,headers:c,validate:!1}),m=g.statusCode,y=g.headers,v=g.result;return delete y["content-encoding"],delete y["transfer-encoding"],{statusCode:m,headers:y,body:JSON.stringify(v)}},t.playground=(0,o.default)({endpoint:"/graphql"})},function(e,t){e.exports=require("hapi")},function(e,t){e.exports=require("graphql-playground-middleware-lambda")},function(e,t){e.exports=require("bluebird")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(13)),a=s(r(3)),o=s(r(20)),u=r(36);function s(e){return e&&e.__esModule?e:{default:e}}var i={$meta:"main server manifest",server:a.default.get("/server"),register:{plugins:[{plugin:r(52)},o.default,n.default]}};i.register.plugins=i.register.plugins.concat(u.userPlugins),t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(14));t.default={plugin:n.default,options:{path:"/playground",endpoint:"/graphql"}}},function(e,t){e.exports=require("graphql-playground-middleware-hapi")},function(e,t){e.exports=require("confidence")},function(e){e.exports={name:"TruePackage",version:"1.0.0",description:"wond api",scripts:{test:'echo "Error: no test specified" && exit 1',start:"nodemon -- --inspect --debug ./node_modules/.bin/sls offline start -r us-east-1 --noTimeout --skipCacheInvalidation",deploy:"sls deploy -s production -v",logs:"sls logs -s production -t -f api"},main:"index.js",license:"MIT",dependencies:{"apollo-server-hapi":"^1.3.6","aws-lambda":"^0.1.2","aws-sdk":"^2.302.0","babel-core":"^6.26.3","babel-eslint":"^8.2.5","babel-loader":"^7.1.5","babel-plugin-istanbul":"^4.1.6","babel-plugin-source-map-support":"^2.0.1","babel-polyfill":"^6.26.0","babel-preset-es2015":"^6.24.1","babel-preset-stage-3":"^6.24.1","babel-runtime":"^6.26.0",bcryptjs:"^2.4.3",bluebird:"^3.5.1",boom:"^7.2.0",confidence:"^3.0.2","csv-parse":"^2.5.0",csvtojson:"^2.0.8",debug:"^3.1.0","eslint-config-walmart":"^2.2.1","eslint-plugin-filenames":"^1.3.2","eslint-plugin-import":"^2.13.0",graphql:"^0.13.2","graphql-custom-types":"^1.4.0","graphql-depth-limit":"^1.1.0","graphql-playground-middleware-hapi":"^1.7.2","graphql-playground-middleware-lambda":"^1.7.2","graphql-query-complexity":"^0.1.2","graphql-relay":"^0.5.5","graphql-tag":"^2.9.2","graphql-tools":"^3.0.5",hapi:"^17.5.2","hapi-auth-jwt2":"^8.1.0",hoek:"^5.0.3",joi:"^13.4.0","js-yaml":"^3.12.0",json2csv:"^4.2.1",jsonwebtoken:"^8.3.0",lodash:"^4.17.10",mongoose:"^5.2.2",nodemon:"^1.17.5","prettier-eslint-cli":"^4.7.1","raw-loader":"^0.5.1",request:"^2.87.0","request-promise":"^4.2.2",serverless:"^1.28.0","serverless-domain-manager":"^2.6.0","serverless-offline":"^3.25.6","serverless-offline-scheduler":"^0.3.3","serverless-secrets-plugin":"^0.1.0","serverless-webpack":"^5.2.0","stack-trace":"^0.0.10",webpack:"^4.15.1","webpack-node-externals":"^1.7.2"},devDependencies:{}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){return e&&e.__esModule?e:{default:e}})(r(18)).default.EventEmitter.prototype._maxListeners=100,process.setMaxListeners(100),t.default={port:process.env.PORT,host:"0.0.0.0",routes:{cors:!0}}},function(e,t){e.exports=require("events")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};n.key={$filter:"env",development:"development-key",sandbox:"giQqgR98eAJJtF[92mRoAnV]U3}sUhtPd$z&vW]>h7%Us3R24ZL)Kb3)",production:process.env.JWT_SECRET||"giQqgR98eAJJtF[92mRoAnV]U3}sUhtPd$z&vW]>h7%Us3R24ZL)Kb3)",test:"test-key",$default:null},n.expires={$filter:"env",development:"30d",sandbox:"30d",production:"30d",test:"1m",$default:"1h"},n.verifyOptions={algorithms:["HS256"]},n.complete=!1,n.headerKey=!1,n.urlKey="jwt",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(21),a=function(e){return e&&e.__esModule?e:{default:e}}(r(22));t.default={plugin:n.graphqlHapi,options:{path:"/graphql",graphqlOptions:function(e){var t=e.payload;return console.log(t,"<-- our graphQL request body"),{schema:a.default}}}}},function(e,t){e.exports=require("apollo-server-hapi")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(23),a=function(e){return e&&e.__esModule?e:{default:e}}(r(24)),o=r(25),u=r(28),s=r(32);var i=(0,n.makeExecutableSchema)({typeDefs:["\nschema {\n  query: Query\n  mutation: Mutation\n}\n",o.userType.default,u.customerType.default,s.itemType.default],resolvers:a.default.merge({},o.userResolvers,u.customerResolvers,s.itemResolvers)});t.default=i},function(e,t){e.exports=require("graphql-tools")},function(e,t){e.exports=require("lodash")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userType=t.userResolvers=void 0;var n=r(26);Object.defineProperty(t,"userResolvers",{enumerable:!0,get:function(){return n.userResolvers}});var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(27));t.userType=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userResolvers=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2));t.userResolvers={Query:{getUser:async function(e,t){console.log(e,t);var r=void 0;return t.name&&(r=await n.default.findOne({name:t.name})),t.gender&&(r=await n.default.findOne({gender:t.gender})),r}},Mutation:{createUser:async function(e,t){return console.log(e,t),await n.default.findOneAndUpdate({name:t.name},{$set:{name:t.name,gender:t.gender}},{new:!0,upsert:!0})}}}},function(e,t){e.exports="type User {\n  _id: ID!\n  name: String!\n  gender: String\n  managerid: [String]\n  customerids: [String]\n}\n\ntype Query {\n  getUser(name: String, gender: String): User\n  users: [User]\n}\n\ntype Mutation {\n  createUser(name: String, gender: String): User\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.customerType=t.customerResolvers=void 0;var n=r(29);Object.defineProperty(t,"customerResolvers",{enumerable:!0,get:function(){return n.customerResolvers}});var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(31));t.customerType=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.customerResolvers=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(30));t.customerResolvers={Query:{getCustomerByName:async function(e,t){return await n.default.findOne({name:t.name})}},Mutation:{createCustomer:async function(e,t){return console.log(t),await n.default.findOneAndUpdate({name:t.name},{$set:{name:t.name,agentid:t.agentid,status:"prospect"}},{new:!0,upsert:!0})}}}},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var a=n.default.Schema,o=new a({name:{type:String,default:""},agentid:{type:a.ObjectId,ref:"Users"},status:{type:String,default:"dead"}}),u=void 0;try{u=n.default.model("Customers",o)}catch(e){u=n.default.model("Customers")}e.exports=u},function(e,t){e.exports="type Customer {\n  _id: ID!\n  name: String!\n  agentid: ID!\n  status: String\n}\n\nextend type Query {\n  getCustomerByName(name: String): Customer\n}\n\nextend type Mutation {\n  createCustomer(name: String!, agentid: ID!, status: String): Customer\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.itemType=t.itemResolvers=void 0;var n=r(33);Object.defineProperty(t,"itemResolvers",{enumerable:!0,get:function(){return n.itemResolvers}});var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(35));t.itemType=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.itemResolvers=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(34));t.itemResolvers={Query:{getItemByName:async function(e,t){return await n.default.findOne({name:t.name})}}}},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var a=n.default.Schema,o=new a({description:{type:String,default:""},name:{type:String,default:""},sku:{type:String,default:""},price:{type:Number,default:0},agentid:{type:a.ObjectId,ref:"Users"}}),u=void 0;try{u=n.default.model("Items",o)}catch(e){u=n.default.model("Items")}e.exports=u},function(e,t){e.exports="type Item {\n  _id: ID!\n  name: String,\n  description: String,\n  price: String,\n  agentid: ID\n}\n\nextend type Query {\n  getItemByName(name: String!): Item\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userPlugins=void 0;var n=i(r(37)),a=i(r(43)),o=i(r(44)),u=i(r(45)),s=i(r(49));function i(e){return e&&e.__esModule?e:{default:e}}t.userPlugins=[n.default,a.default,o.default,u.default,s.default]},function(e,t,r){"use strict";var n=i(r(4)),a=i(r(5)),o=i(r(6)),u=i(r(2)),s=r(7);function i(e){return e&&e.__esModule?e:{default:e}}var l=(0,i(r(1)).default)("login").log,d=async function(e,t){try{var r=e.payload;console.log(r,"safdsafdsafsafsafd"),l(r,"payload");var o=r.organization,i=r.email,d=r.password,c=r.role,f=await u.default.findOne({email:i,role:c,"organization.name":o}).exec();if(!f)return a.default.unauthorized();if(await n.default.compare(d,f.password)){var p=(0,s.createJwt)(f);return t.response(p)}return a.default.notFound("Sorry, that password or email is not recognized.")}catch(e){throw e}};t.plugin={name:"login",register:async function(e,t){return e.route({method:"POST",path:"/login",handler:d,config:{auth:!1,validate:{payload:{email:o.default.string().email().required(),password:o.default.string().required(),organization:o.default.string().required(),role:o.default.string().required()}}}}),Promise.resolve()}}},function(e,t){e.exports=require("hoek")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("stack-trace")},function(e,t,r){"use strict";(0,function(e){return e&&e.__esModule?e:{default:e}}(r(1)).default)("login").log;var n=async function(e,t){return t.response("Ok")};t.plugin={name:"logout",register:async function(e,t){return e.route({method:"POST",path:"/logout",handler:n,config:{auth:!1}}),Promise.resolve()}}},function(e,t,r){"use strict";var n=i(r(4)),a=i(r(5)),o=i(r(6)),u=i(r(2)),s=r(7);function i(e){return e&&e.__esModule?e:{default:e}}var l=async function(e,t){var r=e.payload;try{if(console.log(r," this is the payload, hello testing a log in here"),await u.default.findOne({email:r.email,organization:r.organization}).exec())throw a.default.unauthorized();var o={$set:{organization:{name:r.organization},profile:{firstName:r.firstName,lastName:r.lastName,name:r.firstName+" "+r.lastName},role:r.role,email:r.email},$addToSet:{roles:r.role}},i=await n.default.genSalt(10),l=await n.default.hash(r.password,i);o.$set.password=l;var d=await u.default.findOneAndUpdate({email:r.email},o,{upsert:!0,new:!0}).exec(),c=(0,s.createJwt)(d);return t.response({token:c,user:d})}catch(e){throw(0,a.default)(e)}};t.plugin={name:"users",register:async function(e,t){return e.route({method:"POST",path:"/users",handler:l,config:{auth:!1,validate:{payload:{email:o.default.string().email().required(),password:o.default.string().required(),organization:o.default.string().required(),role:o.default.string().required(),firstName:o.default.string().required(),lastName:o.default.string().required()}}}}),Promise.resolve()}}},function(e,t,r){"use strict";var n=u(r(46)),a=u(r(47)),o=u(r(48));function u(e){return e&&e.__esModule?e:{default:e}}var s=async function(e,t){var r=e.payload;try{var u={method:"GET",uri:r.csvUrl,headers:{},json:!0};try{var s=await(0,a.default)(u);return(0,n.default)().fromString(s).then(async function(e){console.log(e,"csv object ");var r=new o.default;return r.items=e,await r.save(),t.response(r.items)}).catch(function(e){console.log(e,"why")})}catch(e){throw e}}catch(e){return e}};t.plugin={name:"csv",register:async function(e,t){return e.route({method:"POST",path:"/csv",handler:s,config:{auth:!1}}),Promise.resolve()}}},function(e,t){e.exports=require("csvtojson")},function(e,t){e.exports=require("request-promise")},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var a=n.default.Schema,o=new a({organization:{type:String,default:""},adminid:{type:a.ObjectId,ref:"Users"},items:{type:Array,default:[]}}),u=void 0;try{u=n.default.model("Inventory",o)}catch(e){u=n.default.model("Inventory")}e.exports=u},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(50));var a=async function(e,t){var r=new n.default,a=e.payload,o=await r.getSignedUrl(a.fileName,a.fileType);return t.response(o)};t.plugin={name:"signature",register:async function(e,t){return e.route({method:"POST",path:"/users/signature",handler:a,config:{auth:!1}}),Promise.resolve()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=o(r(51));o(r(1));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.accessKeyId="AKIAJAHXEKMU2BP5M57Q",this.secretAccessKey="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"}return n(e,[{key:"getSignedUrl",value:async function(e,t){a.default.config.update({accessKeyId:this.accessKeyId,secretAccessKey:this.secretAccessKey});var r=new a.default.S3({accessKeyId:this.accessKeyId,secretAccessKey:this.secretAccessKey});try{return{signedRequest:await r.getSignedUrl("putObject",{Bucket:"truepackageinventory",Key:e,Expires:60,ContentType:t,ACL:"public-read"})}}catch(e){return"no data"}}}]),e}();t.default=u},function(e,t){e.exports=require("aws-sdk")},function(e,t,r){"use strict";var n=(0,function(e){return e&&e.__esModule?e:{default:e}}(r(1)).default)("hello").log;t.plugin={name:"hello",register:async function(e,t){return e.route({method:"POST",path:"/hello",handler:async function(e,t){n("hi");var r=t.response({value:"it works"});return console.log(e.payload,"safdsafsfsf"),r}}),Promise.resolve()}}}]));
//# sourceMappingURL=handler.js.map